/*
 * Complete workflow test configuration for LMDseq pipeline
 * Runs entire workflow from FASTQ to DESeq2 QC plots
 */

params {
    // Input files
    input = "${projectDir}/test_data/Sample_test.txt"
    outdir = "results"
    
    // Use minimal test references for faster execution
    transcript_fasta = "${projectDir}/test_refs/test_transcripts.fa"
    gtf = "${projectDir}/test_refs/test_genes.gtf"
    reference = "${projectDir}/test_refs/gene_ref.txt"
    
    // Pipeline settings
    pseudo_aligner = 'kallisto'
    seq_mode = 'SE'  // Single-end mode for test data
    
    // Run complete workflow - enable all steps
    skip_fastqc = false
    skip_trimming = false
    skip_multiqc = false
    
    // Kallisto settings
    extra_kallisto_quant_args = '-b 30 --single-overhang'
    kallisto_quant_fraglen = 200
    kallisto_quant_fraglen_sd = 200
    
    // DESeq2 parameters
    min_reads = 5  // Lower threshold for test data
    
    // Resource configuration
    max_cpus = 4
    max_memory = '12.GB'
    max_time = '4.h'
}

// Process-specific configuration for complete workflow
process {
    // Retry logic for robustness
    errorStrategy = 'retry'
    maxRetries = 1
    
    // Resource allocation optimized for completion
    withName: 'KALLISTO_INDEX' {
        memory = { 6.GB * task.attempt }
        cpus = 2
        time = '1.h'
    }
    
    withName: 'KALLISTO_QUANT' {
        memory = { 4.GB * task.attempt }
        cpus = 2
        time = '30.min'
    }
    
    withName: 'CAT_FASTQ' {
        memory = '2.GB'
        cpus = 1
        time = '15.min'
    }
    
    withName: 'FASTQC' {
        memory = '2.GB'
        cpus = 1
        time = '20.min'
    }
    
    withName: 'TRIMGALORE' {
        memory = '4.GB'
        cpus = 2
        time = '30.min'
    }
    
    withName: 'BAM_COVERAGE' {
        memory = '3.GB'
        cpus = 1
        time = '30.min'
    }
    
    withName: 'SAMTOOLS' {
        memory = '2.GB'
        cpus = 1
        time = '15.min'
    }
    
    withName: 'TXIMPORT' {
        memory = '4.GB'
        cpus = 1
        time = '20.min'
    }
    
    withName: 'DESEQ2_NORM_QC' {
        memory = { 6.GB * task.attempt }
        cpus = 2
        time = '1.h'
    }
    
    withName: 'MULTIQC' {
        memory = '3.GB'
        cpus = 1
        time = '20.min'
    }
    
    // Default fallback for any other processes
    cpus = 1
    memory = { 2.GB * task.attempt }
    time = '30.min'
}